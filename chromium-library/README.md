# Native library for Chromium SWT

## Build native library and subprocess executable

### Prerequisites

- Rust (https://www.rust-lang.org/en-US/install.html)

- Download CEF binary distrubution (minimal is enough for release builds), unzip it and rename to ./chromium_subp/cef_[os]/ (Where [os]=linux|osx|windows)

### Build

#### Build subprocess helper executable

- cd chromium_subp
- `cargo build --release`
- `strip target/release/chromium_subp` (linux only)
- `strip -r -u target/release/chromium_subp` (macos only)
- `install_name_tool -change "@rpath/Frameworks/Chromium Embedded Framework.framework/Chromium Embedded Framework" "@loader_path/../../../Chromium Embedded Framework.framework/Chromium Embedded Framework" target/release/chromium_subp` (macos only)

#### Build native library

- cd chromium_swt
- `cargo build --release`
- `strip target/release/libchromium_swt.so` (linux only)
- `strip -r -u target/release/libchromium_swt.dylib` (macos only)
- `install_name_tool -change "@rpath/Frameworks/Chromium Embedded Framework.framework/Chromium Embedded Framework" "@loader_path/Chromium Embedded Framework.framework/Chromium Embedded Framework" target/release/libchromium_swt.dylib` (macos only)

Copy library and binary from target/release/ to corresponding eclipse fragment

### Bindings

CEF bindings for Rust and Java are autogenerated. Types to generate are configured on build.rs and cef_*.h header files.

#### Generate Rust CEF Bindings

- cd chromium_subp
- `cargo build --features gen --release`

#### Generate Java CEF Bindings

- cd chromium_subp
- `cargo build --features genJava --release`
- format: `java -jar /path/to/google-java-format-1.6-all-deps.jar --replace target/CEF.java`
- cp target/CEF.java ../../org.eclipse.swt.chromium/src/org/eclipse/swt/internal/chromium/CEF.java
